{% extends 'base.html' %}

{% block content %}

{% if request.user.is_authenticated %}

  <h1>The {{ request.user.username|capfirst }}'s Journey</h1>

  {% for post in posts %}
    {% if post.author == request.user %}
        <article>
            <h2>{{ post.title }}</h2>
            <div>
                {% if request.user.is_authenticated %}
                    <a href="{% url 'posts:edit' username=request.user.username slug=post.slug %}">Éditer</a>
                    <a href="{% url 'posts:delete' username=request.user.username slug=post.slug %}">Supprimer</a>
                {% endif %}
            </div>
            <h5>Publié par <i>{{ post.author_or_default|capfirst }}</i> le {{ post.created_on|date:'j F Y' }}</h5>
            <p>{{ post.content|safe|truncatewords:50 }}</p>

            <form action="{% url 'posts:post' username=request.user.username slug=post.slug %}">
              <button>Lire l'article</button>
            </form>


            {% if post.images.all.first %}
                <div class="text-center">
                    <img class="detail_picture img-thumbnail" src="{{ post.images.all.first.img.url }}">
                </div>
            {% endif %}

        </article>

      {% else %}

      <article>

        <h2>{{ post.title }}</h2>

        <h5>Publié par <i>{{ post.author_or_default|capfirst }}</i> le {{ post.created_on|date:'j F Y' }}</h5>

        <p>{{ post.content|safe|truncatewords:50 }}</p>

        <form action="{% url 'posts:post' username=request.user.username slug=post.slug %}">
          <button>Lire l'article</button>
        </form>


        {% if post.images.all.first %}
            <div class="text-center">
                <img class="detail_picture img-thumbnail" src="{{ post.images.all.first.img.url }}">
            </div>
        {% endif %}

      </article>

    {% endif %}
{% endfor %}


  {% else %}

  <h1> You should register first</h1>
  <a href="{% url 'signup' %}">Sign Up</a>

{% endif %}


{% endblock %}
